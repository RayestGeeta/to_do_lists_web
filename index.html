<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>待办事项清单</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<script>
  window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
</script>
<script defer src="/_vercel/insights/script.js"></script>
<body>
    <div class="container">
        <header>
            <h1>待办事项清单</h1>
        </header>
        
        <div class="todo-form">
            <input type="text" id="todo-input" placeholder="添加新的待办事项..." autofocus>
            <button id="add-button"><i class="fas fa-plus"></i></button>
        </div>
        <div class="search-container">
            <input type="text" id="search-input" placeholder="搜索待办事项...">
        </div>
        <div class="settings-container">
            <button id="dark-mode-toggle">切换黑暗模式</button>
            <select id="language-select">
                <option value="zh">中文</option>
                <option value="en">English</option>
            </select>
            <button id="sync-button">同步到云端</button>
            <div id="sync-status"></div>
        </div>
        
        <div class="filter-container">
            <div class="filters">
                <span class="filter active" data-filter="all">全部</span>
                <span class="filter" data-filter="active">未完成</span>
                <span class="filter" data-filter="completed">已完成</span>
            </div>
            <button id="clear-completed">清除已完成</button>
        </div>
        
        <ul id="todo-list">
            <!-- 待办事项将通过JavaScript动态添加 -->
        </ul>
        
        <div class="todo-stats">
            <span id="items-left">0 项待办</span>
        </div>
    </div>
    
    <footer>
        <p>双击待办事项可以编辑 | 拖动可以重新排序 | 支持日期、优先级、标签</p>
    </footer>
    
    <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
    import { getFirestore, collection, doc, setDoc, getDoc, onSnapshot, enableIndexedDbPersistence } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js';
    
    // Firebase配置
    // 注意：在实际使用时，您需要用您自己的Firebase项目配置替换这些值
    const firebaseConfig = {
        apiKey: 'YOUR_API_KEY',
        authDomain: 'YOUR_PROJECT_ID.firebaseapp.com',
        projectId: 'YOUR_PROJECT_ID',
        storageBucket: 'YOUR_PROJECT_ID.appspot.com',
        messagingSenderId: 'YOUR_SENDER_ID',
        appId: 'YOUR_APP_ID'
    };
    
    // 初始化Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    
    // 启用离线持久化
    enableIndexedDbPersistence(db)
      .catch((err) => {
          if (err.code == 'failed-precondition') {
              // 多个标签页打开时可能会失败
              console.warn('Persistence failed: Multiple tabs open');
          } else if (err.code == 'unimplemented') {
              // 当前浏览器不支持持久化
              console.warn('Persistence is not available in this browser');
          }
      });
      
    // 将Firebase对象暴露给全局，以便app.js使用
    window.auth = auth;
    window.db = db;
    window.GoogleAuthProvider = GoogleAuthProvider;
    window.signInWithPopup = signInWithPopup;
    window.doc = doc;
    window.setDoc = setDoc;
    window.getDoc = getDoc;
    window.onSnapshot = onSnapshot;
    window.signOut = signOut;
</script>
<script src="app.js"></script>
</body>
</html>